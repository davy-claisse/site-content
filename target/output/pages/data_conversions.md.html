<div class="page-header">
<h1>
Data conversions
</h1>
</div>
<h2 id="pass-through-framework">Pass-through framework</h2>
<p>Please, see <a href="pass_through_framework">Pass-through framework</a> for more information on data conversions.</p>
<h2 id="how-to-see-mapped-type">How to see mapped type</h2>
<p>This is pretty easy, insert a record into a table using standard DBMS tools, and then query it like this:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">Person p = Person.<span class="fu">findAll</span>().<span class="fu">get</span>(<span class="dv">0</span>);
System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;DOB type: &quot;</span> + p.<span class="fu">get</span>(<span class="st">&quot;dob&quot;</span>).<span class="fu">getClass</span>());</code></pre></td></tr></table></div>
<h2 id="convenience-conversion-methods">Convenience conversion methods</h2>
<blockquote>
<p>Convenience conversion methods are used after data was loaded into models due to read operations</p>
</blockquote>
<p>ActiveJDBC provides a number of getter methods for conversion. Most conversions use the underlying <a href="http://javalite.github.io/activejdbc/snapshot/org/javalite/common/Convert.html">Convert</a> class. Here are some examples:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">Date date = person.<span class="fu">getDate</span>(<span class="st">&quot;dob&quot;</span>);
Boolean projectCompleted = project.<span class="fu">getBoolean</span>(<span class="st">&quot;completed&quot;</span>);</code></pre></td></tr></table></div>
<p>Most all types can be converted to String, including a CLOB. Consider this example, where column CONTENT is defined as CLOB:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">String text = article.<span class="fu">getString</span>(<span class="st">&quot;content&quot;</span>);</code></pre></td></tr></table></div>
<p>Here is a list conversion getters available in models:</p>
<pre><code>BigDecimal  getBigDecimal(String attributeName)
Boolean getBoolean(String attributeName)
byte[]  getBytes(String attributeName)
Date    getDate(String attributeName)
Double  getDouble(String attributeName)
Float   getFloat(String attributeName)
Integer getInteger(String attributeName)
Long    getLong(String attributeName)
Short   getShort(String attributeName)
String  getString(String attributeName)
Time    getTime(String attributeName)
Timestamp   getTimestamp(String attributeName)</code></pre>
<h2 id="converters">Converters</h2>
<blockquote>
<p>Converters are triggered during model save operations</p>
</blockquote>
<p>A <a href="http://javalite.github.io/activejdbc/snapshot/org/javalite/activejdbc/conversion/Converter.html">Converter</a> can convert values from one type to another. Currently there are a few converters available: blank to null, zero to null, date (date to string and string to date), and timestamp (timestamp to string and string to timestamp).</p>
<p>Converters will always convert from the original type of the value (for example, java.lang.String for a value like &quot;1926-06-01&quot;) to the type of the convenience conversion method called, and they are registered to model attributes. So for the <code>setDate(&quot;dob&quot;, &quot;1926-06-01&quot;)</code> call, if there is a converter from String (original value type) to java.sql.Date (setting a date with setDate) registered for the attribute &quot;dob&quot;, it will be used and the value set will be of type java.sql.Date. The same applies to getters, the other way around.</p>
<h3 id="date-converters">Date converters</h3>
<p>Date converters can do conversions between formatted string and java.sql.Date. Here is an example that registers date converters to &quot;dob&quot; attribute:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Person <span class="kw">extends</span> Model {
    <span class="dt">static</span> {
        <span class="fu">dateFormat</span>(<span class="st">&quot;MM/dd/yyyy&quot;</span>, <span class="st">&quot;dob&quot;</span>);
    }    
}</code></pre></td></tr></table></div>
<p>and here how to use them:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">Person p = <span class="kw">new</span> <span class="fu">Person</span>();

<span class="co">// will convert String to java.sql.Date</span>
p.<span class="fu">setDate</span>(<span class="st">&quot;dob&quot;</span>, <span class="st">&quot;06/23/1912&quot;</span>); 
<span class="co">// will convert Date to String, if dob value in model is of type Date</span>
String str = p.<span class="fu">getString</span>(<span class="st">&quot;dob&quot;</span>); 

<span class="co">// will convert Date to String</span>
p.<span class="fu">setString</span>(<span class="st">&quot;dob&quot;</span>, <span class="kw">new</span> Date());
<span class="co">// will convert String to java.sql.Date, if dob value in model is of type String</span>
Date date = p.<span class="fu">getDate</span>(<span class="st">&quot;dob&quot;</span>);</code></pre></td></tr></table></div>
<h3 id="timestamp-converters">Timestamp converters</h3>
<p>Timestamp converters are identical to date converters, but do conversion to and from java.sql.Timestamp. Here is an example of declaration:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Message <span class="kw">extends</span> Model {
    <span class="dt">static</span>{
        <span class="fu">timestampFormat</span>(<span class="st">&quot;yyyy.MM.dd G &#39;at&#39; HH:mm:ss z&quot;</span>, <span class="st">&quot;send_time&quot;</span>);
    }
}</code></pre></td></tr></table></div>
<h3 id="blank-to-null-converter">Blank-to-null converter</h3>
<p>The blank to null converter transforms any <code>java.lang.String</code> values that are empty or contain only whitespaces to null. It works with any getter or setter. Here is an example that registers it to two attributes:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Person <span class="kw">extends</span> Model {
    <span class="dt">static</span> {
        <span class="fu">blankToNull</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;last_name&quot;</span>);
    }    
}</code></pre></td></tr></table></div>
<h3 id="zero-to-null-converter">Zero-to-null converter</h3>
<p>The zero to null converter works as the blank to null converter, but transforms <code>java.lang.Number</code> values that are equal zero to null. Here is example of declaration:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Salary <span class="kw">extends</span> Model {
    <span class="dt">static</span> {
        <span class="fu">zeroToNull</span>(<span class="st">&quot;bonus&quot;</span>);
    }    
}</code></pre></td></tr></table></div>
<h2 id="custom-setters-and-getters">Custom setters and getters</h2>
<p>If you like more control over types, you can provide typed getters and setters:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Person <span class="kw">extends</span> Model{
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setName</span>(String name){
       <span class="fu">set</span>(<span class="st">&quot;name&quot;</span>, name);
    }
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setDob</span>(Date dob){
       <span class="fu">set</span>(<span class="st">&quot;dob&quot;</span>, dob);
    }
}</code></pre></td></tr></table></div>
<p>and then use it like this:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">Person p = <span class="kw">new</span> <span class="fu">Person</span>();
p.<span class="fu">setName</span>(<span class="st">&quot;John&quot;</span>);
p.<span class="fu">setDob</span>(<span class="kw">new</span> Date(12345L));</code></pre></td></tr></table></div>
<p>For more information on setters and getters, see <a href="setters_and_getters">Setters and getters</a></p>
<h2 id="what-happens-if-i-stick-a-wrong-type">What happens if I stick a wrong type?</h2>
<p>If you do this:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">Student p = <span class="kw">new</span> <span class="fu">Student</span>();
p.<span class="fu">set</span>(<span class="st">&quot;first_name&quot;</span>, <span class="st">&quot;John&quot;</span>);
p.<span class="fu">set</span>(<span class="st">&quot;last_name&quot;</span>, <span class="st">&quot;Doe&quot;</span>);
p.<span class="fu">set</span>(<span class="st">&quot;dob&quot;</span>, <span class="dv">1</span>); <span class="co">// ===&gt;&gt;  this is wrong type for DOB field</span>
p.<span class="fu">saveIt</span>();</code></pre></td></tr></table></div>
<p>you are going to get an exception from the DBMS itself, if it cannot convert the type:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">org.<span class="fu">javalite</span>.<span class="fu">activejdbc</span>.<span class="fu">DBException</span>: com.<span class="fu">mysql</span>.<span class="fu">jdbc</span>.<span class="fu">MysqlDataTruncation</span>: Data truncation: Incorrect date value: &#39;<span class="dv">1</span>&#39; <span class="kw">for</span> column &#39;dob&#39; at row <span class="dv">1</span>, Query: INSERT INTO <span class="fu">students</span> (first_name, dob, last_name) <span class="fu">VALUES</span> (?, ?, ?), params: John,<span class="dv">1</span>,Doe
    at com.<span class="fu">mysql</span>.<span class="fu">jdbc</span>.<span class="fu">MysqlIO</span>.<span class="fu">checkErrorPacket</span>(MysqlIO.<span class="fu">java</span>:<span class="dv">2868</span>)
    at com.<span class="fu">mysql</span>.<span class="fu">jdbc</span>.<span class="fu">MysqlIO</span>.<span class="fu">sendCommand</span>(MysqlIO.<span class="fu">java</span>:<span class="dv">1573</span>)
    at com.<span class="fu">mysql</span>.<span class="fu">jdbc</span>.<span class="fu">ServerPreparedStatement</span>.<span class="fu">serverExecute</span>(ServerPreparedStatement.<span class="fu">java</span>:<span class="dv">1169</span>)
    at com.<span class="fu">mysql</span>.<span class="fu">jdbc</span>.<span class="fu">ServerPreparedStatement</span>.<span class="fu">executeInternal</span>(ServerPreparedStatement.<span class="fu">java</span>:<span class="dv">693</span>)</code></pre></td></tr></table></div>
<p>ActiveJDBC is a <em>pass-through</em> framework - it will pass data to lower level to handle.</p>
<h2 id="different-data-types-for-the-same-attribute">Different data types for the same attribute</h2>
<p>Is this possible? Yes, for instance, take this example:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">p.<span class="fu">set</span>(<span class="st">&quot;dob&quot;</span>, <span class="st">&quot;2011-12-3&quot;</span>);
p.<span class="fu">saveIt</span>();</code></pre></td></tr></table></div>
<p>This will work for MySQL, and the driver will convert the String &quot;2011-12-3&quot; during insert or update. However, if you retain a reference to this model, the internal value type is going to remain String.</p>
<h2 id="should-i-care-about-types">Should I care about types?</h2>
<p>Not so much. Just use the models with types you think are appropriate, and ActiveJDBC together with the driver will handle most of what you need. In case you get a conversion exception from the driver, do a due diligence then.</p>
