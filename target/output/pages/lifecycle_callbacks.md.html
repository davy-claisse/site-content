<div class="page-header">
<h1>
Lifecycle callbacks
</h1>
</div>
<p>Like ActiveRecord, ActiveJDBC has lifecycle callbacks. These are methods that can be implemented on a Model subclass to get notified of a special life cycle event performed on a model. These callbacks are captured in an interface that is implemented by a <code>Model</code> class:</p>
<h2 id="callback-interface">Callback interface</h2>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">interface</span>  CallbackListener {

    <span class="dt">void</span> <span class="fu">afterLoad</span>(Model m);

    <span class="dt">void</span> <span class="fu">beforeSave</span>(Model m);
    <span class="dt">void</span> <span class="fu">afterSave</span>(Model m);

    <span class="dt">void</span> <span class="fu">beforeCreate</span>(Model m);
    <span class="dt">void</span> <span class="fu">afterCreate</span>(Model m);

    <span class="dt">void</span> <span class="fu">beforeDelete</span>(Model m);
    <span class="dt">void</span> <span class="fu">afterDelete</span>(Model m);

    <span class="dt">void</span> <span class="fu">beforeValidation</span>(Model m);
    <span class="dt">void</span> <span class="fu">afterValidation</span>(Model m);
}</code></pre></td></tr></table></div>
<p>See: <a href="http://javalite.github.io/activejdbc/snapshot/org/javalite/activejdbc/CallbackListener.html">CallbackListener</a></p>
<p>There are total of eight calls that a subclass can override to get notified of a specific event.</p>
<h2 id="registration-of-external-listeners">Registration of external listeners</h2>
<p>You can implement the <a href="http://javalite.github.io/activejdbc/snapshot/org/javalite/activejdbc/CallbackListener.html">CallbackListener</a> interface external to any model and then register it:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode java">CallbackAdapter adapter = <span class="kw">new</span> <span class="fu">CallbackAdapter</span>() {
        <span class="fu">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">afterLoad</span>(Model m) {
            <span class="co">//do what you need to after a model is loaded with data from the database.</span>
        }
    };

Person.<span class="fu">callbackWith</span>(adapter);</code></pre></td></tr></table></div>
<p>This is assuming that Person is a model. You can implement either the <a href="http://javalite.github.io/activejdbc/snapshot/org/javalite/activejdbc/CallbackListener.html">CallbackListener</a> interface or extend <a href="http://javalite.github.io/activejdbc/org/javalite/activejdbc/snapshot/CallbackAdapter.html">CallbackAdapter</a> (where all methods are implemented with blank bodies) and only override the ones you need.</p>
<h2 id="override-model-callback-methods">Override Model callback methods</h2>
<p>The Model class already extends a class <a href="http://javalite.github.io/activejdbc/snapshot/org/javalite/activejdbc/CallbackAdapter.html">CallbackAdapter</a>, which provides empty implementations of these eight methods. All a developer needs to do is to override one or more methods to perform a task at a certain time.</p>
<h2 id="usage">Usage</h2>
<p>Let's say we have a model <code>User</code>:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> User <span class="kw">extends</span> Model{}</code></pre></td></tr></table></div>
<p>A user also has a password that needs to be stored in a DB in an encrypted form. Using callbacks is useful in this case, since all you have to do is to override a <code>beforeSave()</code> method and provide some encryption routine to make the password secure:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> User <span class="kw">extends</span> Model{
   <span class="kw">public</span> <span class="dt">void</span> <span class="fu">beforeSave</span>(){
      <span class="fu">set</span>(<span class="st">&quot;password&quot;</span> <span class="fu">encryptPassword</span>());
   }   
   <span class="kw">private</span> String <span class="fu">encryptPassword</span>(){
      <span class="co">//do what it takes</span>
   }
}</code></pre></td></tr></table></div>
<p>The framework will call <code>beforeSave()</code> within a context of <code>save()</code> or <code>saveIt()</code> when appropriate, and your code will encrypt the password for storage.</p>
