<div class="page-header">
<h1>
Captcha
</h1>
</div>
<p><a href="http://en.wikipedia.org/wiki/CAPTCHA">Captcha</a> is often used in dynamic websites to protect from bots. ActiveWeb has Captcha built-in and does not depend on any third party library for it.</p>
<h2 id="usage">Usage</h2>
<p>Here is an example of a CaptchaController:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> CaptchaController <span class="kw">extends</span> AppController {
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">index</span>() <span class="kw">throws</span> IOException {
        String captchaText = Captcha.<span class="fu">generateText</span>();
        <span class="fu">session</span>(<span class="st">&quot;captcha&quot;</span>, captchaText);
        <span class="fu">outputStream</span>(<span class="st">&quot;image/png&quot;</span>).<span class="fu">write</span>(Captcha.<span class="fu">generateImage</span>(captchaText));
    }
}</code></pre></td></tr></table></div>
<p>This controller has only three lines of code.</p>
<ul>
<li>Line 3. it generates some random text using a class Captcha</li>
<li>Line 4. the text is placed into a session</li>
<li>Line 5. the Captcha class is used to generate a PNG image and stream it to the browser. This image will have the same text as as what is stored in the current session, and once the form is submitted, you can compare (in a different controller) text that is submitted in a form and text found in the session.</li>
</ul>
<h2 id="rendering-captcha">Rendering Captcha</h2>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="kw">&lt;img</span><span class="ot"> class=</span><span class="st">&quot;captcha&quot;</span><span class="ot"> src=</span><span class="st">&quot;${context_path}/captcha&quot;</span><span class="ot"> id=</span><span class="st">&quot;captcha_img&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;#&quot;</span><span class="ot"> onclick=</span><span class="st">&quot;$(&#39;#captcha_img&#39;).attr(&#39;src&#39;, &#39;${context_path}/captcha?t=&#39; + new Date().getTime());&quot;</span><span class="kw">&gt;</span>Reset captcha<span class="kw">&lt;/a&gt;</span></code></pre></td></tr></table></div>
<p>Rendering Captcha is done by simply pointing an IMG tag to the <code>CaptchaController.index()</code> method. Each time the action is executed, a new text and new image is generated.</p>
<p>The &quot;Reset captcha&quot; link is an example on how to re-generate the text and image. The timestamp is needed sometimes to prevent the browser from caching the image.</p>
<h2 id="generated-image">Generated image</h2>
<p>Here is the default image generated by the framework:</p>
<div class="figure">
<img src="images/captcha.png" alt="Captcha image" />
<p class="caption">Captcha image</p>
</div>
<p>Code that generates it can be found here: <a href="https://github.com/javalite/activeweb/blob/master/activeweb/src/main/java/org/javalite/activeweb/Captcha.java">Captcha.java</a>. This class can be easily modified to make the Captcha harder or easier to read.</p>
<p>An example of using Captcha can be found in the <a href="https://github.com/javalite/kitchensink/blob/master/src/main/java/app/controllers/CaptchaController.java">Kitchensink</a> sample application.</p>
