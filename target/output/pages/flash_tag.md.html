<div class="page-header">
<h1>
Flash tag
</h1>
</div>
<p>Flash is a concept which does not exist in standard Java API, but is very useful in web applications. Flash is a snippet of HTML whose life cycle is limited by the next HTTP request. In other words, a flash is created during a request, then it can be used in a subsequent request (of the same session), after which it dies.</p>
<p>Flash messages are useful in cases when a POST/Redirect to GET pattern is used.</p>
<h2 id="use-case-1-pass-message-from-controller">Use case 1: pass message from controller</h2>
<p>Flash messages are created in controllers (or filters) like so:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="fu">@POST</span>
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">create</span>(){
    Book book = <span class="kw">new</span> Book();
    book.<span class="fu">fromMap</span>(<span class="fu">params1st</span>());
    <span class="kw">if</span>(!book.<span class="fu">save</span>()){
        <span class="fu">flash</span>(<span class="st">&quot;message&quot;</span>, <span class="st">&quot;Something went wrong, please  fill out all fields&quot;</span>);
        <span class="fu">flash</span>(<span class="st">&quot;errors&quot;</span>, book.<span class="fu">errors</span>());
        <span class="fu">flash</span>(<span class="st">&quot;params&quot;</span>, <span class="fu">params1st</span>());
        <span class="fu">redirect</span>(BooksController.<span class="fu">class</span>, <span class="st">&quot;new_form&quot;</span>);
    }<span class="kw">else</span>{
        <span class="fu">flash</span>(<span class="st">&quot;message&quot;</span>, <span class="st">&quot;New book was added: &quot;</span> + book.<span class="fu">get</span>(<span class="st">&quot;title&quot;</span>));
        <span class="fu">redirect</span>(BooksController.<span class="fu">class</span>);
    }
}</code></pre></td></tr></table></div>
<p>In a code of controller above, a new book is submitted in a POST request.</p>
<ul>
<li><p>Line 5 is making attempt to save the book information to DB.</p></li>
<li><p>Lines 6, 7, 8 - in case of failure, three instances of flash are created: &quot;message&quot;, &quot;errors&quot; and &quot;params&quot;, where &quot;message&quot; is a generic message displayed at the top of page, &quot;params&quot; is a map with submitted values (it is used to re-populate input fields) and the &quot;error&quot; is a map with error messages</p></li>
<li><p>Line 11 - In case of success request is redirected to BooksController index method and the flash message is sent to view. The file <code>/views/books/index.ftl</code> would have a flash message displayed with &quot;flash&quot; tag:</p></li>
</ul>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>@flash name=&quot;message&quot;/&gt;</code></pre></td></tr></table></div>
<blockquote>
<p>For a complete example of using FlashTag, please refer to <a href="https://github.com/javalite/activeweb-simple/blob/master/src/main/java/app/controllers/BooksController.java#L45">BooksController#save()</a> and corresponding views. Also, please see <a href="validations">ActiveJDBC Validation</a></p>
</blockquote>
<p>The Flash tag automatically detects if a flash message exists and displays it. If a message is missing, nothing is rendered.</p>
<p>Since the user was redirected to the BooksController with an HTTP GET method, the page can simply be reloaded if a user presses &quot;Reload&quot; button on browser. However, if a user actually reloads the page, the flash message will disappear, because it cannot survive across more than one request.</p>
<p>In general, POST/Redirect to GET is a good programming pattern to use in case you need &quot;destructive&quot; operations. Leaving a user on a POSTed page is a bad idea, because the same request can be re-submitted if user presses Reload.</p>
<h2 id="use-case-2-named-flashtag-with-body">Use case 2: Named FlashTag with body</h2>
<p>If you need to display a more complex HTML than a simple string, you can do so by placing a flash tag with body on the page:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>@flash name=&quot;warning&quot;&gt;
 <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;warning&quot;</span><span class="kw">&gt;</span>${message}<span class="kw">&lt;/div&gt;</span>
<span class="er">&lt;</span>/@flash&gt;</code></pre></td></tr></table></div>
<p>and calling a single argument method inside the controller:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="fu">@POST</span>
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">create</span>(){
<span class="co">//.. code before</span>
    <span class="fu">flash</span>(<span class="st">&quot;warning&quot;</span>);
<span class="co">//.. code after</span>
}</code></pre></td></tr></table></div>
<p>The body inside the flash tag lives by the same rules as any other in the template. You can use variables, normal syntax, lists or even partials:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>@flash name=&quot;warning&quot;&gt;
<span class="er">&lt;</span>@render partial=&quot;message&quot;/&gt;
<span class="er">&lt;</span>/@flash&gt;</code></pre></td></tr></table></div>
<p>It allows to organize code for error and warning messages into reusable componets.</p>
<h2 id="use-case-3-anonymous-flashtag-with-body">Use case 3: Anonymous FlashTag with body</h2>
<p>In case you only need one flash tag with body, no need to specify a name:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>@flash&gt;
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;message&quot;</span><span class="kw">&gt;</span>Hello, this is a flash message!<span class="kw">&lt;/div&gt;</span>
<span class="er">&lt;</span>/@flash&gt;</code></pre></td></tr></table></div>
<p>In controller:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="fu">@POST</span>
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">create</span>(){
    <span class="co">//...</span>
    <span class="fu">flash</span>();
    <span class="co">//...</span>
}</code></pre></td></tr></table></div>
<h2 id="testing-named-flash-with-message">Testing named flash with message</h2>
<p>If you set this in the controller:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="fu">@POST</span>
<span class="kw">public</span> <span class="kw">class</span> BooksController <span class="kw">extends</span> AppController{
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">create</span>(){
        <span class="co">// ...</span>
        <span class="fu">flash</span>(<span class="st">&quot;success&quot;</span>, <span class="st">&quot;Your book was saved successfully&quot;</span>)
        <span class="co">// ...</span>
    }
}</code></pre></td></tr></table></div>
<p>Then you can write a test like this:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> BooksControllerSpec <span class="kw">extends</span> DBControllerSpec{
   <span class="kw">public</span> <span class="dt">void</span> <span class="fu">shouldSaveBook</span>(){
        <span class="fu">request</span>().<span class="fu">params</span>(<span class="st">&quot;title&quot;</span>, <span class="st">&quot;To Kill a Mockingbird&quot;</span>, <span class="st">&quot;author&quot;</span>, <span class="st">&quot;Harper Lee&quot;</span>).<span class="fu">post</span>(<span class="st">&quot;save&quot;</span>);
        <span class="fu">the</span>(<span class="fu">flash</span>(<span class="st">&quot;success&quot;</span>)).<span class="fu">shouldBeEqual</span>(<span class="st">&quot;Your book was saved successfully&quot;</span>);
   }
}</code></pre></td></tr></table></div>
<h2 id="testing-named-flash-with-body">Testing named flash with body</h2>
<p>If you set this in the controller:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="fu">@POST</span>
<span class="kw">public</span> <span class="kw">class</span> BooksController <span class="kw">extends</span> AppController{
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">create</span>(){
        <span class="co">// ...</span>
        <span class="fu">flash</span>(<span class="st">&quot;success&quot;</span>)
        <span class="co">// ...</span>
    }
}</code></pre></td></tr></table></div>
<p>and your view looks like this:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>@flash name=&quot;success&quot;&gt;
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;success&quot;</span><span class="kw">&gt;</span>Your book was saved successfully!<span class="kw">&lt;/div&gt;</span>
<span class="er">&lt;</span>/@flash&gt;</code></pre></td></tr></table></div>
<p>Then you can write a test like this:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> BooksControllerSpec <span class="kw">extends</span> DBControllerSpec{
   <span class="kw">public</span> <span class="dt">void</span> <span class="fu">shouldSaveBook</span>(){
        <span class="fu">request</span>().<span class="fu">params</span>(<span class="st">&quot;title&quot;</span>, <span class="st">&quot;To Kill a Mockingbird&quot;</span>, <span class="st">&quot;author&quot;</span>, <span class="st">&quot;Harper Lee&quot;</span>).<span class="fu">post</span>(<span class="st">&quot;save&quot;</span>);
        <span class="fu">the</span>(<span class="fu">flashExists</span>(<span class="st">&quot;success&quot;</span>)).<span class="fu">shouldBeTrue</span>();
        <span class="fu">the</span>(<span class="fu">responseContent</span>()).<span class="fu">shouldContain</span>(<span class="st">&quot;Your book was saved successfully!&quot;</span>);
   }
}</code></pre></td></tr></table></div>
<h2 id="rendering-dynamic-snippets-of-html-old-method">Rendering dynamic snippets of HTML (old method)</h2>
<p>Older method is still operational, but not recommended:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>#if (flasher.message) ??&gt;
   <span class="kw">&lt;span</span><span class="ot"> style=</span><span class="st">&quot;background-color:red&quot;</span><span class="kw">&gt;</span>
   <span class="er">&lt;</span>@flash name=&quot;message&quot;/&gt;
   <span class="kw">&lt;/span&gt;</span>
<span class="er">&lt;</span>/#if&gt;</code></pre></td></tr></table></div>
<p>The HTML code inside the IF condition has no restrictions to use any dynamic values from session of those passed into view by controller.</p>
<h2 id="internationalization-of-flash-messages">Internationalization of flash messages</h2>
<p>The FlashTag is not internationalized. However, you can do this using one of two methods.</p>
<h3 id="method-1-use-class-messages-in-controller">Method 1: Use class Messages in controller</h3>
<p>Lets say your <code>activeweb_messages_properties</code> file contains this entry:</p>
<pre><code>book_added=A book {0} was added to your library. Author: {1}</code></pre>
<p>Please, refer to <a href="http://javalite.github.io/activejdbc/snapshot/org/javalite/activejdbc/Messages.html">org.javalite.activejdbc.Messages</a></p>
<p>In controller write this:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="fu">flash</span>(<span class="st">&quot;saved&quot;</span>, Messages.<span class="fu">message</span>(<span class="st">&quot;book_added&quot;</span>, <span class="st">&quot;Hunger Games&quot;</span>, <span class="st">&quot;Suzanne Collins&quot;</span>));</code></pre></td></tr></table></div>
<p>In view:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>@flash name=&quot;saved&quot; /&gt;</code></pre></td></tr></table></div>
<p>This will print:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode html">A book Hunger Games was added to your library. Author: Suzanne Collins</code></pre></td></tr></table></div>
<h3 id="method-2-use-messagetag">Method 2: Use MessageTag</h3>
<p>Lets say your <code>activeweb_messages_properties</code> file contains this entry:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode html">book_added=A book was added to your library.</code></pre></td></tr></table></div>
<p>In controller:</p>
<div class="sourceCode"><table class="sourceCode java numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode java"><span class="fu">flash</span>(<span class="st">&quot;saved&quot;</span>);</code></pre></td></tr></table></div>
<p>In view:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="er">&lt;</span>@flash name=&quot;saved&quot;&gt;
  <span class="er">&lt;</span>@message key=&quot;book_added&quot;/&gt;
<span class="er">&lt;</span>/@flash&gt;</code></pre></td></tr></table></div>
<p>This will print:</p>
<div class="sourceCode"><table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode html">A book {0} was added to your library. Author: {1}</code></pre></td></tr></table></div>
<p>Method 1 should be used when you have parametrized messages. There is no way to pass a parameter to the MessageTag in method 2, because it is running in a different request (after redirect).</p>
<p>Choose a method that most appropriate for your app.</p>
